# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 4
# CI/CD Build and Deploy

## –ó–∞–¥–∞–Ω–∏–µ

1. –ù–∞–ø–∏—Å–∞—Ç—å ‚Äú–ø–ª–æ—Ö–æ–π‚Äù CI/CD —Ñ–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –≤ –Ω–µ–º –µ—Å—Ç—å –Ω–µ –º–µ–Ω–µ–µ –ø—è—Ç–∏ –ø–ª–æ—Ö–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫ –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é CI/CD
2. –ù–∞–ø–∏—Å–∞—Ç—å ‚Äú—Ö–æ—Ä–æ—à–∏–π‚Äù CI/CD, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—Å–µ –ø–ª–æ—Ö–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
3. –£–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–ª–æ—Ö–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –Ω–∞ —Ö–æ—Ä–æ—à–∏–µ, —Å—Ä–∞–≤–Ω–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

## –•–æ–¥ —Ä–∞–±–æ—Ç—ã

### –í–≤–µ–¥–µ–Ω–∏–µ

–í –∫–∞—á–µ—Å—Ç–≤–µ CI/CD –±—ã–ª –≤—ã–±—Ä–∞–Ω Github Actions, –Ω–∞–≤–µ—Ä–Ω–æ–µ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –¥–ª—è –≤–≤–µ–¥–µ–Ω–∏—è –≤ CI/CD –∏ –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —Å–≤–æ–π CI/CD –≤ –º–æ–Ω–æ-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤–º–µ—Å—Ç–µ —Å –∫–æ–¥–æ–º –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—É–∫—Ç—É—Ä—ã.

–Ø –Ω–∞–ø–∏—Å–∞–ª CI/CD —Å—Ä–∞–∑—É –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –≤–∏–¥–µ, —Ä–∞–∑–±–∏–≤ –Ω–∞ —Ä–∞–∑–Ω—ã–µ –≤–æ—Ä–∫—Ñ–ª–æ—É - –±–∏–ª–¥, –¥–µ–ø–ª–æ–π, –≤–æ—Ä–∫—Ñ–ª–æ—É –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∏–ª–∏ —Å–æ–≤–º–µ—â–µ–Ω–∏—è –±–∏–ª–¥–∞ –∏ –¥–µ–ø–ª–æ—è, –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–æ—Ä–∫—Ñ–ª–æ—É –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –±–∏–ª–¥–∞/–¥–µ–ø–ª–æ—è.

–û–ø–∏—à—É bad practices, –∏ –∫–∞–∫ –æ–Ω–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –∏—Ç–æ–≥–æ–≤–æ–º CI/CD.
–ö–æ–Ω–µ—á–Ω–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π CI/CD –ø–æ–ª—É—á–∏–ª—Å—è –Ω–µ –∏–¥–µ–∞–ª—å–Ω—ã–π, —Ç–∞–º –Ω–µ—Ç:
1. –ü—Ä–æ–≥–æ–Ω–∞ —Ç–µ—Å—Ç–æ–≤
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –±–∏–ª–¥–∞ –ø—Ä–∏ –ø—É—à–µ –≤ –º–∞—Å—Ç–µ—Ä (–∏–ª–∏ –≤ RC –≤–µ—Ç–∫—É)

–ù–æ –∑–∞—á–∞—Å—Ç—É—é –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–µ –Ω—É–∂–Ω—ã –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤.

C CI/CD —è —Ä–∞–±–æ—Ç–∞–ª –∏ —Ä–∞–±–æ—Ç–∞—é –≤—Ä–µ–º—è –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ä–∞–±–æ—Ç–µ, –∏ —ç—Ç–æ –∫–∞–∫ —Ä–∞–∑ GitHub Actions, —Ö–æ—Ç—è —è –¥—É–º–∞–ª –Ω–∞–¥ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º –¥—Ä—É–≥–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏—è, –∏ –¥–∞–∂–µ –ø–æ–¥–Ω–∏–º–∞–ª –µ–≥–æ –Ω–∞ —Å—Ç–µ–π–¥–∂ –æ–∫—Ä—É–∂–µ–Ω–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä ArgoCD –∏ Jenkins, –æ–¥–Ω–∞–∫–æ –¥–ª—è –Ω–∞—à–∏—Ö —Ä–µ–∞–ª–∏–π —ç—Ç–æ –±—ã–ª –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π –æ–≤–µ—Ä—Ö–µ–¥, –∏ –Ω–∞–º –ø–æ–∫–∞ —Å –≥–æ–ª–æ–≤–æ–π —Ö–≤–∞—Ç–∞–µ—Ç GitHub Actions.

### –û–ø–∏—Å–∞–Ω–∏–µ

#### Bad/Best Practices - –∫–∞–∫ –Ω–µ –Ω–∞–¥–æ –¥–µ–ª–∞—Ç—å, –∞ –∫–∞–∫ –Ω–∞–¥–æ:
- –í–µ—Å—å CI/CD –ø–∞–π–ø–ª–∞–π–Ω –≤ –æ–¥–Ω–æ–π –¥–∂–æ–±–µ –∏ –≤ –æ–¥–Ω–æ–º —Å—Ç–µ–ø–µ:
 –ü–∏—Å–∞—Ç—å –≤—Å–µ –∫–æ–º–º–∞–Ω–¥—ã –∏ —à–∞–≥–∏ —Å–±–æ—Ä–∫–∏/—Ç–µ—Å—Ç–æ–≤/–¥–µ–ø–ª–æ—è/–ø–æ—Å—Ç-–¥–µ–ø–ª–æ–π–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –≤ –æ–¥–Ω–æ–π –¥–∂–æ–±–µ –∏ –≤ –æ–¥–Ω–æ–º —Å—Ç–µ–ø–µ –∫–æ–Ω–µ—á–Ω–æ –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ, –∏ –ø—Ä–∏—á–∏–Ω –Ω–µ—Å–∫–æ–ª—å–∫–æ:
    1. –≠—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å –∏ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ —ç—Ç–æ–º
    2. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –∑–∞–≤–∞–ª–∏—Ç—Å—è –ø—Ä–∏–¥–µ—Ç—Å—è –±–µ–≥–∞—Ç—å –ø–æ –ª–æ–≥–∞–º –∏ –∏—Å–∫–∞—Ç—å –ø–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ
    3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –∫–æ–º–º–∞–Ω–¥—ã –∏–ª–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ, –Ω–∞–¥–æ –±—É–¥–µ—Ç –ª–µ–ø–∏—Ç—å —É—Å–ª–æ–≤–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∞ bash
    
- –ü–ª–æ—Ö–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —à–∞–≥–æ–≤ –∏ –¥–∂–æ–±:
  –ö–∞–∫ –∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏, –Ω–∞–¥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–º–µ–Ω–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é –≤–µ—â—å, —á—Ç–æ –±—ã –¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫ (–∏–ª–∏ –≤—ã —á–µ—Ä–µ–∑ –≥–æ–¥), —Å–º–æ–≥–ª–∏ —Å –ª–µ–≥–∫–æ—Å—Ç—å—é —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –∏ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ CI/CD –∏ —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–∞–∂–¥—ã–π —à–∞–≥ –∏ –¥–∂–æ–±–∞

- –°–ª–∏—è–Ω–∏–µ –±–∏–ª–¥–∞ –∏ –¥–µ–ø–ª–æ—è (–∏ —Ç–µ—Å—Ç–æ–≤):
  –†–∞–∑–¥–µ–ª—è—Ç—å –≤–æ—Ä–∫—Ñ–ª–æ—É –∏–ª–∏ —Ö–æ—Ç—è –±—ã –¥–∂–æ–±—ã –±–∏–ª–¥–∞, –¥–µ–ø–ª–æ—è –∏ —Ç–µ—Å—Ç–æ–≤ –Ω–∞–¥–æ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞, –∏ —ç—Ç–æ –±–µ–∑ —Å–æ–º–Ω–µ–Ω–∏—è —Ä–∞–Ω–æ –∏–ª–∏ –ø–æ–∑–¥–Ω–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è, –∫ —Ç–æ–º—É –∂–µ —ç—Ç–æ –ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–≥–∞–µ—Ç –æ—Ç –æ—à–∏–±–æ—á–Ω—ã—Ö –¥–µ–ø–ª–æ–µ–≤ –Ω–∞ –ø—Ä–æ–¥ —Å–ª–æ–º–∞–Ω–Ω—ã—Ö –±–∏–ª–¥–æ–≤. –ù–∞–¥–æ —Ä–∞–∑–¥–µ–ª—è—Ç—å –≤—Å–µ —ç—Ç–∏ –≤–æ—Ä–∫—Ñ–ª–æ—É, –∏ –æ–±—å–µ–¥–∏–Ω—è—Ç—å –∏—Ö –≤ –¥—Ä—É–≥–æ–º, —á—Ç–æ –±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —É—Å–ª–æ–≤–Ω–æ —Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –∞ –ø–æ—Å–ª–µ —Ä—É—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —É–∂–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥ - —Ç–∞–∫ —É –≤–∞—Å –Ω–∞ –ø—Ä–æ–¥ –ø–æ–ø–∞–¥–µ—Ç –±–∏–ª–¥ –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –±—ã–ª —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏. (–∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é —ç—Ç–æ –Ω–µ —Å–ø–∞—Å–∞–µ—Ç –æ—Ç –Ω–µ–ø—Ä–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–¥ –æ–∫—Ä—É–∂–µ–Ω–∏—è)

- –°–µ–∫—Ä–µ—Ç—ã –≤ workflow:
  –¢–∞–∫ –Ω–µ –Ω–∞–¥–æ, –∏–Ω–∞—á–µ –ª—é–±–æ–π –∫—Ç–æ —É–≤–∏–¥–∏—Ç –ª–æ–≥–∏ CI/CD - —É–≤–∏–¥–∏—Ç –∏ —Å–µ–∫—Ä–µ—Ç—ã, –∫–∞–∫ –º–∏–Ω–∏–º—É–º - Github Actions Secrets - –æ—á–µ–Ω—å —É–¥–æ–±–Ω—ã–π –∏ –ª–µ–≥–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∑–∞—á–∞—Å—Ç—É—é –µ–≥–æ —Ö–≤–∞—Ç–∞–µ—Ç. –ù–æ –µ—Å–ª–∏ –æ—á–µ–Ω—å –Ω–∞–¥–æ –∑–∞—â–∏—Ç–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã, —á—Ç–æ, –¥–∞–∂–µ –≤ yaml —Ñ–∞–π–ª–∞—Ö –∫—É–±–µ—Ä–∞ –∏–ª–∏ –≤ env –º–∞—à–∏–Ω—ã –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –≤—Å–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, —ç—Ç–∏—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–Ω–æ, —Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Hashicorp Vault, —Å –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ –ø–æ–¥, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞ —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏, –∏ —É–¥–∞–ª–µ–Ω–∏–µ–º —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–æ—Å–ª–µ —á—Ç–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º (–Ω–∞ —Ä–∞–±–æ—Ç–µ —è —Ç–∞–∫ —Å–¥–µ–ª–∞–ª, –Ω–æ –¥–ª—è –Ω–∞—Å —ç—Ç–æ –æ–ø—è—Ç—å –±—ã–ª –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π –æ–≤–µ—Ä—Ö–µ–¥).

- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ-–∑–∞–ø—É—Å–∫–∞ CI/CD –¥–ª—è –≤—Å–µ—Ö –≤–µ—Ç–æ–∫:
  –ï—Å–ª–∏ —É –≤–∞—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞, —Ç–æ –Ω–∞–¥–æ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —Å –∫–∞–∫–∏—Ö –≤–µ—Ç–æ–∫ —ç—Ç–æ—Ç –ø–∞–π–ø–ª–∞–π–Ω –¥–æ–ª–∂–µ–Ω –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—É—à–∏, —á—Ç–æ –±—ã –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è. –û–±—ã—á–Ω–æ —Ç–∞–∫–∏–º–∏ –≤–µ—Ç–∫–∞–º–∏ –≤—ã—Å—Ç—É–ø–∞—é—Ç RC (release candidate) –≤–µ—Ç–∫–∏.

- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
  –î–ª—è CI/CD –Ω–∞–¥–æ —è–≤–Ω–æ —Ä–∞–∑–¥–µ–ª—è—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –¥–µ–ø–ª–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã, –∞ –¥–ª—è –ø—Ä–æ–¥ –æ–∫—Ä—É–∂–µ–Ω–∏—è –±–µ–∑ –Ω–∏—Ö —É–∂–µ –¥–µ–ø–ª–æ–π –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ–ª—å–∑—è. –ö —Ç–æ–º—É –∂–µ —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–¥–µ–ª—è—Ç—å —Å–µ–∫—Ä–µ—Ç—ã, –∞ –Ω–µ —Å–∫–∏–¥—ã–≤–∞—Ç—å –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∏ –ø—Ä–æ–¥ –æ–∫—Ä—É–∂–µ–Ω–∏–π –Ω–∞ –ª—é–±–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ.

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ
–ê —Å–¥–µ–ª–∞–Ω –ø—Ä–æ—Å—Ç–æ–π –ø–∞–π–ø–ª–∞–Ω –±–∏–ª–¥–∞ –∏ –¥–µ–ø–ª–æ—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Yandex Cloud –≤ –∫–ª–∞—Å—Ç–µ—Ä –∫—É–±–µ—Ä–∞. CI/CD —Å–¥–µ–ª–∞–Ω –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞, –±–µ–∑ —Ç–µ—Å—Ç–æ–≤, –Ω–æ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è (build/deploy/buildAndDeploy), –≤—ã–±–æ—Ä–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–ø–∏—Å–∞–Ω —Ç–æ–ª—å–∫–æ dev), —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–µ–∫—Ä–µ—Ç–æ–≤.

–†–∞–∑–±–µ—Ä–µ–º –ø–æ –ø–æ—Ä—è–¥–∫—É, —á—Ç–æ –±—É–¥–µ—Ç –µ—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å CI/CD —Å–µ—Ä–≤–∏—Å–∞ —Å Build And Deploy:
1. –í—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä—É—á–∫–∞–º–∏:
```yml
name: "[Services] üöÄ Deploy Backend #1"
run-name: ${{ inputs.workflow-action }} on ${{ inputs.environment }} by @${{ github.actor }} from ${{ github.ref }}

on:
  workflow_dispatch:
    inputs:
      environment:
        description: Environment
        required: true
        type: choice
        options:
          - dev
          - staging
          - prod
      helm-action:
        type: choice
        description: Action
        options:
          - upgrade
          - install
          - lint
          - template
      workflow-action:
        type: choice
        description: Workflow Action
        options:
          - Build
          - Deploy
          - Build And Deploy
      clouds-integration:
        type: boolean
        description: Clouds Integration Service
      
jobs:
  clouds-integration:
    if: ${{ inputs.clouds-integration }}
    uses: ./.github/workflows/wfc-build-deploy-backend-service.yml
    with:
      helm-action: ${{inputs.helm-action}}
      service-name: clouds-integration
      dockerfile-path: ./Lab4/CloudsIntegration/CloudsIntegration/Dockerfile
      environment: ${{inputs.environment}}
      workflow-action: ${{inputs.workflow-action}}
    secrets: inherit
```
–ò—Ç–∞–∫, –∫–∞–∫ –º–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ, helm –¥–µ–π—Å—Ç–≤–∏–µ (–æ–±—ã—á–Ω–æ install –∏–ª–∏ upgrade), –¥–µ–π—Å—Ç–≤–∏–µ –∫–æ—Ç–æ—Ä–æ–µ –Ω–∞–¥–æ —Å–¥–µ–ª–∞—Ç—å (build/deploy/buildAndDeploy), –∏ –¥–∞–ª—å—à–µ —á–µ–∫-–±–æ–∫—Å–∞–º–∏ –∏–¥—É—Ç —Å–µ—Ä–≤–∏—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å (—Ç—É—Ç –æ–Ω –æ–¥–∏–Ω). –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ workflow –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –¥–µ–π—Å—Ç–≤–∏—è –¥—Ä—É–≥–∏–º workflow.
2. Workflow –∫–æ—Ç–æ—Ä—ã–π —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –¥–µ–π—Å—Ç–≤–∏–µ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –¥—Ä—É–≥–∏–µ Workflow:
```yml
name: "[Z] Build and deploy backend .net service"

on:
  workflow_call:
    inputs:
      helm-action:
        required: true
        type: string
      service-name:
        required: true
        type: string
      dockerfile-path:
        required: true
        type: string
      workflow-action:
        required: true
        type: string
      environment:
        required: true
        type: string

jobs:
  build:
    if: ${{ inputs.workflow-action == 'Build' || inputs.workflow-action == 'Build And Deploy' }}
    uses: ./.github/workflows/wfc-build-image.yml
    with:
      environment: ${{inputs.environment}}
      dockerfile-path: ${{inputs.dockerfile-path}}
      registry-path: ${{inputs.service-name}}
    secrets: inherit

  deploy:
    if: ${{ inputs.workflow-action == 'Deploy' }}
    uses: ./.github/workflows/wfc-deploy-backend-service.yml
    with:
      environment: ${{inputs.environment}}
      helm-action: ${{inputs.helm-action}}
      service-name: ${{inputs.service-name}}
    secrets: inherit
          
  build_and_deploy:
    if: ${{ inputs.workflow-action == 'Build And Deploy' }}
    needs: [build]
    uses: ./.github/workflows/wfc-deploy-backend-service.yml
    with:
      environment: ${{inputs.environment}}
      helm-action: ${{inputs.helm-action}}
      service-name: ${{inputs.service-name}}
    secrets: inherit

```
–¢—É—Ç –º–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å, —á—Ç–æ –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞, –æ–∫—Ä—É–∂–µ–Ω–∏–µ, helm action, –∏ –¥–µ–π—Å–≤—Ç–∏–µ –∫–æ—Ç–æ—Ä–æ–µ –Ω–∞–¥–æ —Å–æ–≤–µ—Ä—à–∏—Ç—å, –ø–æ—Å–ª–µ —á–µ–≥–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è - —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑/–¥–µ–ø–ª–æ–∏—Ç/—Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑+–¥–µ–ø–ª–æ–∏—Ç –Ω–∞—à —Å–µ—Ä–≤–∏—Å, –∏ –≤—Å–µ —ç—Ç–æ –ø—É—Ç–µ–º –≤—ã–∑–æ–≤–∞ –¥–≤—É—Ö –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è workflow –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–≤–µ—á–∞—é—Ç –∑–∞ –±–∏–ª–¥+–ø—É—à –æ–±—Ä–∞–∑–∞ –≤ —Ä–µ–≥–∏—Å—Ç—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –∑–∞ –¥–µ–ø–ª–æ–π –≤ –∫–ª–∞—Å—Ç–µ—Ä.
3. –ë–∏–ª–¥ –æ–±—Ä–∞–∑–∞ –∏ –ø—É—à –≤ —Ä–µ–µ—Å—Ç—Ä
```yml
name: "[Z] Build .NET image"

on:
  workflow_call:
    inputs:
      dockerfile-path:
        required: true
        type: string
      registry-path:
        required: true
        type: string
      environment:
        required: true
        type: string

jobs:
  build-image:
    runs-on: ubuntu-latest
    steps:
      - name: Get commit info
        id: commit
        uses: prompt/actions-commit-hash@96297fd87f37de8995123eefa42cfe774416d8f1

      - name: Get Yandex token
        uses: yc-actions/yc-iam-token@v1
        id: yandex-cloud-iam-token
        with:
          yc-sa-json-credentials: ${{ secrets.YC_SA_DEV_JSON_CREDENTIALS }}
        
      - name: Docker login in registry
        uses: docker/login-action@v2.0.0
        with:
          registry: cr.yandex
          username: iam
          password: ${{ steps.yandex-cloud-iam-token.outputs.token }}

      - name: Build and push
        uses: docker/build-push-action@v3
        with:
          push: true
          no-cache: true
          tags: cr.yandex/crp76aifpa9n0b74vbhm/${{ inputs.registry-path }}:${{ steps.commit.outputs.short }}
          file: ${{ inputs.dockerfile-path }}
```
–° —ç—Ç–∏–º workflow –≤—Å–µ –ø—Ä–æ—Å—Ç–æ, –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç –ø—É—Ç—å –∫ –¥–æ–∫–µ—Ä—Ñ–∞–π–ª—É —Å–µ—Ä–≤–∏—Å–∞, –ø—É—Ç—å —Ä–µ–µ—Å—Ç—Ä–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –∑–∞—Ç–µ–º –æ–Ω –¥–æ—Å—Ç–∞–µ—Ç —Ö–µ—à-–∫–æ–º–º–∏—Ç–∞ —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–ø—É—â–µ–Ω –ø–∞–π–ø–ª–∞–π–Ω, –ø–æ–ª—É—á–∞–µ—Ç IAM —Ç–æ–∫–µ–Ω —è–Ω–¥–µ–∫—Å –æ–±–ª–∞–∫–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ —Ä–µ–µ—Å—Ç—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, —Å–æ–±–∏—Ä–∞–µ—Ç –∏ –ø—É—à–∏—Ç —ç—Ç–æ—Ç –æ–±—Ä–∞–∑ –≤ —Ä–µ–µ—Å—Ç—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

4. –î–µ–ø–ª–æ–π
```yml
name: "[Z] Deploy backend .net service"

on:
  workflow_call:
    inputs:
      helm-action:
        required: true
        type: string
      service-name:
        required: true
        type: string
      environment:
        required: true
        type: string
        
jobs:
  deploy_dev:
    runs-on: ubuntu-latest
    if: ${{ inputs.environment == 'dev' }}
    steps:
      - uses: actions/checkout@master

      - name: Get commit info
        id: commit
        uses: prompt/actions-commit-hash@v3

      - name: Extract branch name
        shell: bash
        run: (echo "branch=${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}}" | sed 's#/#\_#g') >> $GITHUB_OUTPUT
        id: extract_branch

      - name: Deploy service to cluster
        uses: wahyd4/kubectl-helm-action@master
        env:
          KUBE_CONFIG_DATA: ${{ secrets.KUBE_DEV_CONFIG_DATA }}
        with:
          args: >
            helm ${{ inputs.helm-action }} 
            --set image=cr.yandex/crp76aifpa9n0b74vbhm/${{ inputs.service-name }}:${{ steps.commit.outputs.short }}
            --set environment=Dev
            --set commit_hash=${{ steps.commit.outputs.short }}
            --set branch_name=${{ steps.extract_branch.outputs.branch }}
            --set top_secret=${{ secrets.TOP_SECRET }}
            ${{ inputs.service-name }} 
            -f Lab4/CloudsIntegration/.helm-charts/${{ inputs.service-name }}/${{ inputs.environment }}-values.yaml
            Lab4/CloudsIntegration/.helm-charts/${{ inputs.service-name }} 
            --namespace dumb
```
–¢—É—Ç —Ç–æ–∂–µ –≤—Å–µ –Ω–µ –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ, workflow –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ heml action, –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –∏ —Å—Ä–µ–¥—É –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞–¥–æ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å —Å–µ—Ä–≤–∏—Å, –ø–æ—Å–ª–µ —á–µ–≥–æ –¥–æ—Å—Ç–∞–µ—Ç –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–Ω–∞–∑–≤–∞–Ω–∏–µ –≤–µ—Ç–∫–∏), –∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç helm –¥–ª—è –¥–µ–ø–ª–æ—è –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –µ–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —à–∞–±–ª–æ–Ω–∏–∑–∞—Ü–∏–∏ yaml —Ñ–∞–π–ª–æ–≤ - –ø—É—Ç—å –∫ –æ–±—Ä–∞–∑—É, —Å—Ä–µ–¥—É, —Å–µ–∫—Ä–µ—Ç, –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ –±—ã –≤ –∫—É–±–µ—Ä–µ –º–æ–∂–Ω–æ –±—ã–ª–æ –ª–µ–≥–∫–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç–∫—É–¥–∞ –±—ã–ª –∑–∞–¥–µ–ø–ª–æ–µ–Ω —Å–µ—Ä–≤–∏—Å.

### –§–∏–Ω–∞–ª
–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞ —ç—Ç–æ–º –≤—Å–µ, CI/CD –±—ã–ª –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω, –≤–æ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–∞—Ö - –ø—Ä–æ—Å—Ç–æ —Å–±–æ—Ä–∫–∞/–ø—Ä–æ—Å—Ç–æ –¥–µ–ø–ª–æ–π/—Å–±–æ—Ä–∫–∞+–¥–µ–ø–ª–æ–π. –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –≤ GitHub –ø–æ–ª—É—á–∏–≤—à–∏–π—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

–¢–∞–∫ –∂–µ —Å—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, –≤—Å—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≤–æ–¥–∏–ª–∞—Å—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –æ–±–ª–∞–∫–µ, –∏ –¥–æ—Å—Ç—É–ø –∫ —Å–∞–π—Ç—É –µ—Å—Ç—å —Å–µ–π—á–∞—Å –ø–æ –∞–¥—Ä–µ—Å—Å—É: http://130.193.35.166:30100/ (–≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å–µ–∫—Ä–µ—Ç –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–∫–∏–¥—ã–≤–∞–ª—Å—è —á–µ—Ä–µ–∑ Github Actions, —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞: clouds)
_–ù–∞ –º–æ–º–µ–Ω—Ç –≤–∞—à–µ–≥–æ —á—Ç–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, —Ç–∞–∫ –∫–∞–∫ —É  –∫–≤–æ—Ç–∞ –≤ –æ–±–ª–∞–∫–µ –Ω–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è, —è –æ—Ç–∫–ª—é—á—É –µ–≥–æ —á–µ—Ä–µ–∑ –¥–≤–µ –Ω–µ–¥–µ–ª–∏ (–Ω–∞–¥–µ—é—Å—å —è –Ω–µ –∑–∞–±—ã–ª –ø–æ—Ç—É—à–∏—Ç—å –≤—Å—é –∏–Ω—Ñ—Ä—É :)_

![image](https://github.com/user-attachments/assets/b3c00013-114d-4eaa-8e6c-5a454570e8c7)
![image](https://github.com/user-attachments/assets/7400aad0-8c89-4a82-a83d-96e425318c8a)
![image](https://github.com/user-attachments/assets/f6816314-a78d-45d5-ad80-aac35c10afcf)
![image](https://github.com/user-attachments/assets/f075719f-cb7b-4b61-a21b-38c6640a94eb)




 
